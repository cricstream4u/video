<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG- @cric_stream</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.min.js"></script>
    <style>
        .video-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
        }

        video {
            width: 100%;
            height: auto;
        }

        @media (orientation: landscape) and (fullscreen) {
            video {
                width: 100vw;
                height: 100vh;
                object-fit: contain;
            }
        }
    </style>
</head>
<body>
    <div>
        <h2 style="text-align: center; background-color: #0074d9; color: white; padding: 10px;">Custom DASH Player</h2>
    </div>
    <br>
    <div class="video-container">
        <video id="video-player" controls crossorigin playsinline></video>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            const videoUrl = urlParams.get('video'); // Expect DASH MPD URL in query param "video"

            if (!videoUrl) {
                document.body.innerHTML = "<h2>Video URL missing in query parameter</h2>";
                return;
            }

            const videoElement = document.getElementById('video-player');
            
            // Initialize Dash.js Player
            const dashPlayer = dashjs.MediaPlayer().create();
            dashPlayer.initialize(videoElement, videoUrl, true);

            // Attach Plyr for Modern Interface
            const player = new Plyr(videoElement, {
                controls: [
                    'play-large',
                    'play',
                    'progress',
                    'current-time',
                    'mute',
                    'volume',
                    'settings',
                    'pip',
                    'fullscreen',
                    
                ],
                settings: ['quality'], // Enable settings for customizations
            });

            // Quality Selection Integration
            dashPlayer.updateSettings({
                streaming: {
                    abr: {
                        autoSwitchBitrate: true,
                    },
                },
            });

            dashPlayer.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, () => {
                const availableQualities = dashPlayer.getBitrateInfoListFor('video').map(q => q.height);
                availableQualities.unshift(0); // Add "Auto" option

                player.config.quality = {
                    default: 0,
                    options: availableQualities,
                    forced: true,
                    onChange: (newQuality) => {
                        if (newQuality === 0) {
                            dashPlayer.updateSettings({
                                streaming: {
                                    abr: {
                                        autoSwitchBitrate: true,
                                    },
                                },
                            });
                        } else {
                            const bitrateIndex = dashPlayer.getBitrateInfoListFor('video').findIndex(q => q.height === newQuality);
                            if (bitrateIndex !== -1) {
                                dashPlayer.updateSettings({
                                    streaming: {
                                        abr: {
                                            autoSwitchBitrate: false,
                                        },
                                    },
                                });
                                dashPlayer.setQualityFor('video', bitrateIndex);
                            }
                        }
                    },
                };

                // Update Plyr's settings menu
                player.on('ready', () => {
                    player.settings.set('quality', availableQualities);
                });
            });

            // Error Handling
            dashPlayer.on(dashjs.MediaPlayer.events.ERROR, (e) => {
                console.error('DASH.js error:', e);
                alert('An error occurred while playing the video.');
            });
        });
        
    </script>

    <div style="background-color: #0074d9; text-align: center; padding: 10px; margin-top: 20px;">
        <a href="https://telegram.me/cric_stream" target="_blank">
            <button id="joinTelegramButton">Join Telegram</button>
        </a>
    </div>
</body>
</html>
